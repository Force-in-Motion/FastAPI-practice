```shell
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á RSA —Ä–∞–∑–º–µ—Ä–æ–º 2048 –∏ –¥–∞–µ—Ç –µ–º—É –Ω–∞–∑–≤–∞–Ω–∏–µ jwt-private.pem (–Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±—ã–º)

openssl genrsa -out private.pem 2048

# genrsa - –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º —á—Ç–æ –º—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º RSA

# -out - –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º private.pem, –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Ç–æ –æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è.

# private.pem - –Ω–∞–∑–≤–∞–Ω–∏–≤–µ —Ñ–∞–π–ª–∞ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º pem

# 2048 - —Ä–∞–∑–º–µ—Ä

```shell
# –ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º private.pem –¥–µ–ª–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º public.pem.

openssl rsa -in private.pem -outform PEM -pubout -out public.pem

# openssl rsa ‚Äî –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ RSA-–∫–ª—é—á–µ–π (—á—Ç–µ–Ω–∏–µ, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ).

# -in private.pem ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∏–∑ –∫–∞–∫–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

# -outform PEM ‚Äî –∑–∞–¥–∞—ë—Ç —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞: PEM (—á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π base64).

# -pubout ‚Äî –≥–æ–≤–æ—Ä–∏—Ç OpenSSL:
# üëâ ¬´–ò–∑–≤–ª–µ–∫–∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∏ –≤—ã–≤–µ–¥–∏ –µ–≥–æ¬ª.

# -out public.pem ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ —Ñ–∞–π–ª public.pem.

# üßæ –†–µ–∑—É–ª—å—Ç–∞—Ç:

# –§–∞–π–ª public.pem, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ—Ç–∫—Ä—ã—Ç—ã–π RSA-–∫–ª—é—á –≤ PEM-—Ñ–æ—Ä–º–∞—Ç–µ (base64 + –º–µ—Ç–∫–∏ -----BEGIN PUBLIC KEY-----).


# –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–æ—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –µ–º—É –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–º –ª–∏ –∏–º–µ–Ω–Ω–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–µ–º —ç—Ç–æ —Å–¥–µ–ª–∞–Ω–æ. –¢–æ–µ—Å—Ç—å –∫–ª—é—á–∏ –≤—Å–µ–≥–¥–∞ –≤—ã–ø—É—Å–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–∏ - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π


# –î–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è, –∞ —Ç–∞–∫ –∂–µ –≤—ã–ø—É—Å—Ç–∞ JWT —Ç–æ–∫–µ–Ω–∞ –∏ –µ–≥–æ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π  –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ pyJWT —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º Cryptographic
# pip install 'pyJWT[crypto]'


# ================================================================================================

# –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ JWT —Ç–æ–∫–µ–Ω–∞ 

from pydantic import BaseModel
from pathlib import Path

JWT_DIR = Path(__file__).parent # –ß–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É pathlib –ø–æ–ª—É—á–∞–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞


class JWTSettings(BaseModel):
    """ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –ø—É–±–ª–∏—á–Ω—ã–π –∏ –ø—Ä–∏–≤—ã—Ç–Ω—ã–π –∫–ª—é—á–∏ """

    private_key: Path = JWT_DIR / 'keys' / 'jwt_private.pem' # –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É

    public_key: Path = JWT_DIR / 'keys' / 'jwt_public.pem' # –ü—É—Ç—å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É

    algoritm: str = 'RS256' # –ó–∞–¥–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è 

    access_token: int = 3 # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è access —Ç–æ–∫–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö 
    
    refresh_token: int = 60 # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è refresh —Ç–æ–∫–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö

jwt_settings = JWTSettings()

# =========================================================================================================

# –°–æ–∑–¥–∞–¥–∏–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –ª–æ–≥–∏–∫–µ
class DBExeption(Exception):

    inactive = HTTPException(
        status_code=status.HTTP_403_FORBIDDEN,
        detail="User inactive",
    )

    unauthorized = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Invalid login or password",
    )

    not_found = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="User not found",
    )

    token_invalid = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="User not found",
    )
# =====================================================================================================

# –î–∞–ª–µ–µ –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ JWT –∏–∑ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤,
# –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ JWT –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –µ–≥–æ payload, —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è,
# –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è

from datetime import datetime, timedelta, timezone
import bcrypt
from auth.JWT.schemas.user import UserPublicSchema, UserSchema
from auth.JWT.exeption import DBExeption
import jwt
from auth.JWT.settings import jwt_settings
from fastapi import Form, Depends
from fastapi.security import OAuth2PasswordRequestForm, OAuth2PasswordBearer




oauth2_scheme = OAuth2PasswordBearer(tokenUrl='/login') # –≠—Ç–æ –æ–±—ä–µ–∫—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FastAPI, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω—ã —Å–∞–º, –∞ –ª–∏—à—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization: Bearer <token> –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É. –ü–∞—Ä–∞–º–µ—Ç—Ä tokenUrl –Ω—É–∂–µ–Ω Swagger UI –¥–ª—è –∫–Ω–æ–ø–∫–∏ Authorize ‚Äî —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ä–º—É username/password –∏ –ø–æ–ª—É—á–∞—Ç—å —Ç–æ–∫–µ–Ω.




class JWTUtils:
    """–°–æ–¥–µ—Ä–∂–∏—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å jwt —Ç–æ–∫–µ–Ω–æ–º"""

    @staticmethod
    def expire_jwt() -> dict:
        """
        –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö
        :return: –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö –∏ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
        """
        # –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–¥–∞—Ç—å —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö,
        # –Ω–∞—á–∏–Ω–∞—è —Å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–¥–∞—á–∏–Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∏ –ø—Ä–∏–±–∞–≤–∏—Ç—å –∫ –Ω–µ–º—É –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

        now = datetime.now(timezone.utc) # –ü–æ–ª—É—á–≤–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è

        expire = now + timedelta(minutes=jwt_settings.access_token_expire) # –ü—Ä–∏–±–∞–≤–ª—è–µ–º –∫ —Ç–µ–∫—É—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ now –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

        # JWT –æ–∂–∏–¥–∞–µ—Ç —á–∏—Å–ª–∞ —Å–µ–∫—É–Ω–¥ –æ—Ç Unix Epoch, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç—ã datetime, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏–º–µ–Ω—è–µ–º –º–µ—Ç–æ–¥ timestamp –∫ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º,
        # –∞ –ø–æ—Å–∫–æ–ª—å–∫—É timestamp –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç float —Ç–∏–ø –Ω–∞–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –µ–≥–æ –≤ int
        return { # –°–æ–∑–¥–∞–µ–º –≥–æ—Ç–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å, –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ payload
            "exp": int(expire.timestamp()), # —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è access —Ç–æ–∫–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞—è —Å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ 
            "iat": int(now.timestamp()) # –∫–ª—é—á iat, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω–æ –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω –±—ã–ª –≤—ã–ø—É—â–µ–Ω
        }


    @staticmethod
    def encode_jwt(payload: dict) -> str:
        """
        –°–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–¥–∏—Ä—É–µ—Ç –µ–≥–æ –≤ base64
        :param payload: –ü–æ–ª–µ–∑–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –≤ —Ç–æ–∫–µ–Ω–µ
        :return: –ì–æ—Ç–æ–≤—ã–π –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
        """
        payload_copy = payload.copy() # –ö–æ–ø–∏—Ä—É–µ–º, –ø–æ–ª—É–∫—á–µ–Ω–Ω—ã–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞, payload —á—Ç–æ–±—ã –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π

        # –í —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π payload –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª—é—á exp —Å–æ –∑–Ω–∞—á–Ω–∏–µ–º expire ( —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è access —Ç–æ–∫–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞—è —Å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ )
        # –∏ –∫–ª—é—á iat, –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω–æ –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω –±—ã–ª –≤—ã–ø—É—â–µ–Ω
        payload_copy.update(JWTUtils.expire_jwt()) # –ú–µ—Ç–æ–¥ update –æ–±–æ–≤–∏—Ç payload_copy –¥–µ–Ω–Ω—ã–º–∏ –∏–∑ —Å–ª–æ–≤–∞—Ä—è, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç–æ–¥ expire_jwt, —Ç–æ–µ—Ç—å –¥–æ–±–∞–≤–∏—Ç –≤ payload_copy –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è

        token = jwt.encode( # –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–∫–µ–Ω –≤–æ –µ–¥–∏–Ω–æ
            payload=payload_copy, # –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π payload —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ exp –∏ iat –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            key=jwt_settings.private_key.read_text(), # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
            algorithm=jwt_settings.algorithm, # –ê–ª–≥–æ—Ä–∏—Ç–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω—ã–π ( —É—á–∞—Å—Ç–≤—É—é—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á–∏ )
        )

        return token


    @staticmethod
    def decode_jwt(token: str) -> str:
        """
        –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
        :param token: –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ base64 —Ç–æ–∫–µ–Ω
        :return: –†–∞—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ–∫–µ–Ω–µ payload
        """
        payload = jwt.decode( # –î–æ—Å—Ç–∞–µ–º payload –∏–∑ —Ç–æ–∫–µ–Ω–∞
            jwt=token, # –¢–æ–∫–µ–Ω –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
            key=jwt_settings.public_key.read_text(), # –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
            algorithms=[jwt_settings.algorithm], # –ê–ª–≥–æ—Ä–∏—Ç–º –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ç–∏–ø–∞ Sequence
        )

        return payload
    



class AuthUtils:


    @staticmethod
    def check_user_status(user: UserSchema) -> UserSchema:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ False, —Ç–æ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ—å –Ω–µ –∑–∞–±–ª–æ–∫–∏–ø—Ä–∞–Ω –∏–Ω–∞—á–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
        :param user: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –ë–î
        :return: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        """
        if user.active == False: # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ False - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

            raise DBExeption.inactive

        return user


    @staticmethod
    def hash_password(password: str) -> bytes:
        """
        –•—ç—à–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π, –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å—Ç—Ä–æ–∫–∏, –ø–∞—Ä–æ–ª—å –≤ –±–∞–π—Ç—ã
        :param password: –ü–∞—Ä–æ–ª—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å—Ç—Ä–æ–∫–∏
        :return: –ü–∞—Ä–æ–ª—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –±–∞–π—Ç–æ–≤
        """
        salt = bcrypt.gensalt() # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–ª—å ‚Äî —Å–ª—É—á–∞–π–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –ø–∞—Ä–æ–ª—é –ø–µ—Ä–µ–¥ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

        password_bytes: bytes = password.encode() # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤ –±–∞–π—Ç—ã

        return bcrypt.hashpw(password_bytes, salt) # –ü—Ä–∏ –ø–æ–º–æ—â–∏ –º–µ—Ç–æ–¥–∞ hashpw —Å–æ–∑–¥–∞–µ–º —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–∑ 2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ password_bytes –∏ salt
    

    @staticmethod
    def validate_password(
        password: str,
        hashed_password: bytes,
    ) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–∞—Ä–æ–ª—è –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É –ø–∞—Ä–æ–ª—é –≤ –±–∞–π—Ç–∞—Ö
        :param password: –ü–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–∞—Ä–æ–ª—å
        :param hashed_password: –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        :return: True | False
        """
        return bcrypt.checkpw( # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ, –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –ø–∞—Ä–æ–ª—è –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É –ø–∞—Ä–æ–ª—é –≤ –±–∞–π—Ç–∞—Ö 
            password=password.encode(), # –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–π—Ç—ã –∏ –ø–µ—Ä–µ–¥–∞–µ–º –≤ –º–µ—Ç–æ–¥
            hashed_password=hashed_password # # –ü–µ—Ä–µ–¥–∞–µ–º —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Ö–Ω–∞–Ω–µ–Ω–Ω—ã–π –≤ –±–∞–∑–µ
        )


    @staticmethod
    def validate_user_auth(form_data: OAuth2PasswordRequestForm = Depends()) -> UserSchema:
        """
        –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ
        :param form_data: –ü—Ä–∏ –ø–æ–º–æ—â–∏ Depends() —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç OAuth2PasswordRequestForm, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ, –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–µ –∫–ª–∏–µ–Ω—Ç–∞ form_data.username –∏ form_data.password
        :return: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        """
        user = users_db.get(form_data.username) # –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ª–æ–≥–∏–Ω—É –≤ –±–∞–∑–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –µ–≥–æ

        if not user: # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –Ω–µ—Ç - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
            raise DBExeption.unauthorized

        if not AuthUtils.validate_password( # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω, —Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª–∏: —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ validate_password —Ö—ç—à–∏—Ä—É–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º –≤ –ë–î
            password=form_data.password,
            hashed_password=user.password,
        ):
            raise DBExeption.unauthorized # –ï—Å–ª–∏ –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

        return AuthUtils.check_user_status(user)  # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ True - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–Ω–∞—á–µ –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ



    @staticmethod
    def get_current_user(token: str = Depends(oauth2_scheme)) -> UserPublicSchema:
        """
        –ß–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å oauth2_scheme –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞, –∑–∞—Ç–µ–º –ø–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –∏–∑ —Ç–æ–∫–µ–Ω–∞ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
        :return: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ —Ç–∞–∫–æ–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
        """
        payload = JWTUtils.decode_jwt(token) # –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏ –¥–æ—Å—Ç–∞–µ—Ç payload

        user_name = payload.get('name') # –ü–æ–ª—É—á–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ payload
        
        user = users_db.get(user_name) # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ –µ–≥–æ –∏–º–µ–Ω–∏

        if not user:
            raise DBExeption.not_found
        
        user = AuthUtils.check_user_status(user=user) # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ True - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–Ω–∞—á–µ –≤—ã–±—Ä–æ—Å–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ

        return user


# ====================================================================================================================

# –ü—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫ –∂–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞–±–æ—Ç—ã —Å JWT
# –ü–∞—Ä–∞–º–µ—Ç—Ä strict=True –≥–æ–≤–æ—Ä–∏—Ç —á—Ç–æ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∞–∫–∏–º–∏, –∫–∞–∫–∏–µ —É–∫–∞–∑–∞–Ω—ã –≤ –∞–Ω–æ—Ç–∞—Ü–∏–∏ –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —Å—Ö–µ–º—ã.
# –í –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ ‚Üí Pydantic –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç "25" –≤ 25. from_attributes=True –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–¥–µ–ª—å –∏–∑ –æ–±—ã—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (ORM-–æ–±—ä–µ–∫—Ç–æ–≤, –∫–ª–∞—Å—Å–æ–≤, —Å—É—â–Ω–æ—Å—Ç–µ–π), –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ª–æ–≤–∞—Ä–µ–π.

class UserSchema(BaseModel):
    model_config = ConfigDict(strict=True, from_attributes=True)
    id: int
    name: str
    password: bytes # –ü–∞—Ä–æ–ª—å –±—É–¥–µ—Ç –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω –≤ –±–∞–π—Ç—ã, –ø–æ—ç—Ç–æ–º—É –≤ —Å—Ö–µ–º–µ –º—ã —Ö—Ä–∞–Ω–∏–º —Å—Ä–∞–∑—É –±–∞–π—Ç—ã
    email: EmailStr | None = None
    active: bool = True # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω, —Ç–æ –µ—Å—Ç—å –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è, –≤ —Å–ª—É—á–∞–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –µ–≥–æ –≤ —Ç–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –≤—Ö–æ–¥ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ False, –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–æ–ª—É—á–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—É—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ç–∞—Ç—É—Å False –∑–Ω–∞—á–∏—Ç –¥–æ—Å—Ç—É–ø –µ–º—É –∑–∞–ø—Ä–µ—â–µ–Ω


class UserPublicSchema(BaseModel):
    # –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø–µ—Ä–µ–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–∞—è —Å–ª—É–∂–µ–±–Ω—ã–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ –ø–∞—Ä–æ–ª—å –∏ —Å—Ç–∞—Ç—É—Å
    model_config = ConfigDict(strict=True, from_attributes=True)
    id: int
    name: str
    email: EmailStr | None = None
# ======================================================================================================================

# –î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É —Ç–æ–∫–µ–Ω–∞

class TokenSchema(BaseModel):
    access_token: str
    type_token: str # –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ ( –æ–±—ã—á–Ω–æ Bearer )



# =========================================================================================================================

# –í—å—é, –≤—ã–¥–∞—é—â–µ–µ access —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ –ª–æ–≥–∏–Ω—É –∏ –ø–∞—Ä–æ–ª—é

from auth.JWT.schemas.token import TokenSchema
from auth.JWT.schemas.user import UserPublicSchema, UserSchema
from auth.JWT.utils import JWTUtils, AuthUtils, UserDataParser
from fastapi import APIRouter, Depends

router = APIRouter(tags=["JWT"])


@router.post("/login", response_model=TokenSchema)
async def issues_jwt_to_user(user: UserSchema = Depends(AuthUtils.validate_user_auth)):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ, –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ( –í—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é )
    –í —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ –º—ã –ø–æ–ø–∞–¥–µ–º —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π –ø–∞–ª–∏–¥–∞—Ü–∏–∏ –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è
    :param param:
    :param param:
    :return:
    """
    payload = {"sub": str(user.id), "name": user.name, "emmail": user.email}

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç access_token (—Ç–æ–∫–µ–Ω –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è), –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å payload ( –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É )
    access_token = JWTUtils.encode_jwt(payload)

    return TokenSchema(access_token=access_token, type_token="Bearer")


# –í—å—é, –≤—ã–¥–∞—é—â–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ AuthUtils.get_current_user, –∫–æ—Ç–æ—Ä–∞—è –¥–æ—Å—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Ç–æ–∫–µ–Ω–∞,
# –ü–∞—Ä—Å–∏—Ç –∏—Ö, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
# –¢–∞–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—É—Ç–∏ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ —É–∫–∞–∑–∞–≤—ã–µ—Ç—Å—è –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ –ª—é–±–æ–π –≤—å—é —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

@router.get('/me', response_model=UserPublicSchema)
async def get_user_profile(user: UserPublicSchema = Depends(AuthUtils.get_current_user)):
    """
    –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–∏–º –¥–∞–Ω–Ω—ã–º –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–æ–∫–µ–Ω–µ —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å get_current_user
    :param user:
    :return:
    """
    return user